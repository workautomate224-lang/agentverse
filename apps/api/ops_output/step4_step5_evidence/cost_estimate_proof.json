{
  "evidence_type": "cost_estimate_implementation",
  "step": "4.2",
  "timestamp": "2026-01-11T20:15:00Z",
  "status": "IMPLEMENTED",

  "implementation": {
    "endpoint": "POST /admin/cost-estimate",
    "model_file": "app/models/quota.py (RunEstimate)",
    "admin_file": "app/api/v1/endpoints/admin.py"
  },

  "request_schema": {
    "agent_count": "int",
    "tick_count": "int",
    "model": "string (default: openai/gpt-4o-mini)"
  },

  "response_schema": {
    "estimated_llm_calls": "int",
    "estimated_tokens_min": "int",
    "estimated_tokens_max": "int",
    "estimated_cost_usd_min": "float",
    "estimated_cost_usd_max": "float",
    "estimated_runtime_seconds": "int",
    "estimated_rep_outputs": "int (always 5)",
    "within_quota": "bool",
    "quota_limits": {
      "max_llm_calls": "int",
      "max_tokens": "int",
      "max_cost_usd": "float",
      "max_runtime": "int"
    }
  },

  "estimation_formulas": {
    "llm_calls": "agent_count (one call per agent for persona enrichment)",
    "tokens_min": "llm_calls * 150",
    "tokens_max": "llm_calls * 500",
    "cost_min": "(tokens_min / 1000) * 0.00015",
    "cost_max": "(tokens_max / 1000) * 0.00015",
    "runtime": "(agent_count * 1) + (tick_count * 0.5)"
  },

  "example_estimate": {
    "input": {
      "agent_count": 10,
      "tick_count": 10,
      "model": "openai/gpt-4o-mini"
    },
    "output": {
      "estimated_llm_calls": 10,
      "estimated_tokens_min": 1500,
      "estimated_tokens_max": 5000,
      "estimated_cost_usd_min": 0.000225,
      "estimated_cost_usd_max": 0.00075,
      "estimated_runtime_seconds": 15,
      "estimated_rep_outputs": 5,
      "within_quota": true,
      "quota_limits": {
        "max_llm_calls": 500,
        "max_tokens": 200000,
        "max_cost_usd": 2.0,
        "max_runtime": 300
      }
    }
  },

  "db_logging": {
    "table": "run_estimates",
    "fields": [
      "run_id",
      "user_id",
      "project_id",
      "estimated_llm_calls",
      "estimated_tokens_min",
      "estimated_tokens_max",
      "estimated_cost_usd_min",
      "estimated_cost_usd_max",
      "estimated_runtime_seconds",
      "estimated_rep_outputs",
      "policy_tier",
      "policy_thresholds",
      "created_at"
    ]
  },

  "verification": {
    "endpoint_exists": true,
    "uses_user_tier": true,
    "checks_quota_limits": true,
    "returns_structured_response": true
  }
}
